#!/usr/bin/python
# resync
# Created Fri Jan 15 15:35:35 AKST 2016
# Copyright (C) 2016 by Raymond E. Marcil <marcilr@gmail.com>
#

import os.path

# Used by sys.exit() to exit with error.
import sys

# -------------------------------------------
# Configuration
# -------------------------------------------
DEBUG = "true";
#DEBUG = "false";


#
# List of manifests to check for configuration
# and manifests to clone sync.
#
manifests = ['manifest', '/home/marcilr/.manifest' ]


# -------------------------------------------
# Functions
# -------------------------------------------

#
# debug()
# str - String to print for DEBUG == 'true'
#
def debug( str ):
  if DEBUG == 'true':
      print str
  return

# error()
# str - String with error message to print
#
def error( str ):
   sys.exit(str)
   return


def loop_over_manifest(manifest):
    debug("loop_over_manifest() Looping...")

# To alleviate:
# loop_over_manifest() line: # .manifest
# Traceback (most recent call last):
#   File "./resync", line 100, in <module>
#     get_manifest()
#   File "./resync", line 88, in get_manifest
#     loop_over_manifest(manifest)
#   File "./resync", line 68, in loop_over_manifest
#     source, target == line.split()
# NameError: global name 'source' is not defined


    global source

    for line in open(manifest, 'r'):
        # Remove end whitespace
        line = line.rstrip()
        debug("loop_over_manifest() line: %s" % line)
        print line.split()
        if not line: continue
    debug("loop_over_manifest() Closing manifest")
    file.close
    debug("loop_over_manifest() Closed manifest")
    return


#
# get_manifest()
# Get manifest from the manifests list of manifests.
#
def get_manifest():
    debug( "get_manifest() processing: "
        + str(len(manifests)) + ' manifests')

    for idx, manifest in enumerate(manifests):
        if os.path.isfile(manifest):
            message = "get_manifest() %d, %s" % (idx, manifest)
            debug(message)
            loop_over_manifest(manifest)
        else:
            message = "get_manifest() No %s found, aborting." % manifest
            error(message)
     
    return


# -------------------------------------------
# Main
# -------------------------------------------

get_manifest()

#loop_over_manifest()
